---
title: "Automatization_in_R"
author: "AR"
date: "`r Sys.Date()`"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# 1. Установка R и полезные источники

## 1.1 Установка языка R и окружения

Что такое R?

```         
R — язык программирования, предназначенный для статистической обработки данных. 
```

Конечно, с его помощью можно сделать и сайт, и калькулятор, но основное
предназначение языка заключается именно в статистических расчётах и
моделировании.

Также R представляет собой свободную программную среду с открытым
исходным кодом, которая распространяется абсолютно свободно и имеет
бесчисленное количество обучающих и поясняющих материалов. R доступен
для практически всех существующих операционных систем: Windows, Linux,
macOS, и других.

Основное представительство R в сети --- сайт r-project.org (к нему мы
вернёмся в следующих уроках), на котором пользователи могут не только
установить самые последние обновления, но и изучить почти 11.000
пакетов, доступных для свободной загрузки и в большинстве своём
снабжённых достаточно подробной документацией.

Для того, чтобы начать его использовать, R доступен для работы в
командной строке используемой пользователем ОС или с помощью
стандартного GUI, однако наиболее используемым и обладающим наиболее
удобным интерфейсом многими считается RStudio (осторожно, это не
программа для восстановления файлов).

Важное примечание: все названия папок, в которые мы собираемся
устанавливать R, должны иметь названия на латинице, не содержать
пробелов. Лучше, если будут только латиница и нижние подчёркивания. Чаще
всего проблема возникает с именем пользователя: проверьте, соответствует
ли оно рекомендациям.

```         
C:\Users\user_name\OneDrive\my_jobs\project 
project_name    project-name
username\OneDrive\myjobs\project
```

###### Для установки R необходимо:

```         
Перейти на сайт R возможно по следующей ссылке: https://cran.r-project.org;
Выбрать установленную на компьютере операционную систему и нажать на неё:
Скорее всего, это наша первая установка R, поэтому нажимаем на “install R for the first time” - в результате скачается полная базовая сборка R:
```

После этих процедур у нас будет установленный R, но доступ к нему пока
что возможен исключительно через командную строку или GUI, что чаще
всего решительно неудобно.

###### Установка RTools

Давайте, установим инструменты Rtools с того же сайта, где мы скачивали
дистрибутив языка R.

Rtools --- это набор программ, необходимых в Windows для сборки пакетов
R из исходного кода.

Rtools могут пригодиться, когда мы будем работать с некоторыми пакетами
в ходе анализа, например, устанавливать их не из основного хранилища
CRAN. Алгоритм установки ничем не отличается от установки предыдущих
программ:

```         
Повторяем первые два шага из урока по установке R;
На третьем шаге выбираем RTools: 
Устанавливаем RTools так же, как и R.
```

###### Установка r-base-dev для Linux.

Если у вас Linux, то этот шаг для вас!

```         
1)  Установим r-base-dev:
sudo apt update
sudo apt install r-base-dev
2)  Готово!
```

###### Установка RStudio

У нас установлен R и все необходимые дополнительные пакеты. Но пока что
мы можем использовать R только через командную строку. Установим RStudio
для того, чтобы сделать анализ данных удобным и эффективным.

```         
Перейдём по ссылке на сайт https://www.rstudio.com/products/rstudio/download/ ;
Пролистаем вниз и увидим, что есть варианты установщиков для всех распространённых операционных систем
```

######Сопоставьте, зачем нужны указанные компоненты R - Язык
программирования, ориентированный на статистическую обработку данных
RStudio- Среда разработки, в которой удобно делать статистический анализ
Rtools- Дополнительные компоненты для установки пакетов R

## 1.2 Самостоятельный поиск ответов на частые вопросы

В ходе статистического анализа каждый раз возникают вопросы, не имеющие
быстрого решения. Даже если вы работаете (био)статистиком уже много лет,
эти вопросы возникают почти каждый день, хоть с годами их и становится
меньше.

Здесь мы изучим несколько способов, как искать ответы:

1.  Справка внутри R;

2.  drr.io;

3.  stackoverflow.com;

4.  Поиск ошибки в Google.

Справка внутри R

```         
1.    Знак вопроса (?) в сочетании с названием функции без скобок. Стоит сказать, что это работает только для уже подключённых пакетов. Например, в пакеты stats и base подключены сразу. Например: ?mean, ?sqrt, ?median:

2.    Два знака вопроса (??) в сочетании с названием функции, термином или фразой (на английском языке). Это возвращает справку о пакетах и функциях, подходящих под запрос
```

Поиск информации в Сети

Иногда нужно получить большее количество информации, чем даёт справка. В
таком случае мы идём в Интернет и ищем эту информацию. Рассмотрим
несколько полезных способов:

```         
Функция RSiteSearch() перенаправляет на search.r-project.org, где представлена информация по искомому термину. Обратите внимание, что термин должен быть заключён в кавычки. Пример: RSiteSearch("biostatistics")

Сайт rdrr.io, на котором можно найти почти то же самое, что и выше, но нужно напрямую искать: 

Сайт stackoverflow.com — это жемчужина поиска ответов на вопросы для статистиков/программистов и почти всех, кто связан с компьютерами. В отличие от предыдущих двух сайтов этот наполняется людьми, которые задают вопросы и дают на них ответы. Почти всегда можно найти ответ на свой вопрос и увидеть многочисленные варианты его решения: 
```

# 2. RStudio и создание проектов

## 2.1 Интерфейс RStudio

Что такое RStudio

RStudio --- это IDE (integrated development environment, интегрированная
среда разработки) для языка R.

В число её приятных особенностей входит бесплатность (для базовой
версии), открытый исходный код. Первое значит, что мы можем просто
скачать нужную нам версию без какой-либо оплаты, а второе --- что любой
может убедиться в том, что в коде программы нет посторонних уязвимостей
или скрытых функций.

RStudio существует в двух версиях:

```         
RStudio Desktop — версия для локальных машин, работает непосредственно на компьютере, на котором установлена;
RStudio Server — доступ через браузер к RStudio, установленной на удалённом сервере.
```

##### Разделы верхнего списка

RStudio существует для WIndows, LInux, OS X и написана на C++. В
интерфейсе программы рассмотрим именованные разделы в верхнем списке, а
именно те разделы, которые будем использовать часто.

###### **File**

**File** содержит в себе различные способы работы с файлами:

```         
New File повторяет функционал уже рассмотренной кнопки №1 в графическом меню;
New Project также создаёт новый проект;
Open File просто открывает файл;
Reopen with Encoding открывает файл заново с выбранной кодировкой. Полезно, когда вместо букв в файле видны странные нечитаемые символы — подбор правильной кодировки зачастую очень увлекательное занятие;
Open Project открывает существующий проект;
Open Project in New Session тоже открывает существующий проект, но делает это в новом окне RStudio. Полезно, когда нужно открыть сразу несколько проектов, чтобы изучать их одновременно;
Save сохраняет текущий файл;
Save As сохраняет текущий файл с выбором расширения и названия;
Save with Encoding позволяет сохранить файл с выбором кодировки. Полезно, когда нужно сохранить файл совсем не в той кодировке, в какой он был изначально;
Save All сохраняет все открытые в данный момент файлы;
Close закрывает текущий файл;
Close All закрывает сразу все файлы;
Close All Except Current закрывает все файлы, кроме того, в котором мы находимся в данный момент;
Close Project закрывает текущий проект;
Quit Session закрывает окно RStudio. Используйте с осторожностью.
```

###### **Edit**

**Edit** содержит в себе различные способы взаимодействия
непосредственно с пишущимся кодом:

```         
  Back и Forward позволяют листать положения курсора по истории его... положений;
Undo и Redo позволяют листать уже по изменениям: откатывать на одно изменение назад или возвращать одно изменение вперёд соответственно;
Cut, Copy, Paste повторяют известные горячие клавиши: Ctrl + X, Ctrl + C, Ctrl + V (вырезать, скопировать, вставить) соответственно;
Отдельно стоит поговорить про Find и группу функций, связанных с ней. Так как мы пишем текст, зачастую полезным оказывается искать слова (ведь они повторяются). С помощью Ctrl + F (или просто по нажатию кнопки Find) открывается окно, которое приведено ниже. В следующем шаге мы рассмотрим его подробнее.
```

##### Поиск и замена строк в коде

Часто бывает так, что уже написано несколько сотен строк кода, но
внезапно необходимо найти все вхождения названия функции, которую мы
применяли сто раз. Или даже изменить это название.

Разумеется, малоэффективно и попросту нудно сто раз менять название, к
тому же можно легко допустить ошибку и не заметить этого.

Здесь на помощь приходит find-replace. Вновь разберём основные элементы:

```         
Find — это поле, в которое вводится искомый паттерн из символов, или, простыми словами, искомое слово;
Replace — это поле, в которое вводится паттерн, на который заменяется паттерн из Find;
Next, Prev, All соответственно переключают на следующий искомый паттерн, предыдущий или выбирают все сразу;
Replace, All выбирают, производить ли замену только в одном случае или сразу во всех. При этом, если нажимать Replace раз за разом, то замена будет производиться для следующего паттерна;
In selection переключает поиск в режим "искать только в выделенном заранее сегменте", что позволяет не заменить нечаянно то, что не нужно. Также помогает найти слово в маленьком отрезке кода, когда разбегаются глаза и сложно найти, что было написано только что;
Match case говорит, учитывать регистр (большая буква или маленькая) или нет;
Whole word говорит, искать ли только слово целиком или включить в результат слова, внутри которых находится искомое слово;
Regex переключает поиск в режим регулярных выражений. Это потрясающий инструмент, позволяющий с помощью метасимволов искать и заменять не просто слова, а целые шаблоны.
```

Интересный факт: если мы хотим добавить к строке какую-то ещё строку,
например, ко всем "data" добавить "data_c1", нам достаточно заменить
строку "data" на строку "data_c1".

##### Окно консоли и терминала

Окно терминала нужно только в исключительных случаях, однако полезно
знать, что для того, чтобы выполнить некоторые специфические
манипуляции, не нужно открывать отдельно командную строку.

При написании кода, который должен создать статистический отчёт, каждый
раз возникает ситуация, в которой нужно проверить вывод куска кода здесь
и сейчас, или вывести датасет, в который мы будем периодически
подсматривать при создании функции. Или просто быстро посмотреть, что в
данный момент находится в переменной.

Именно для таких случаев пригождается консоль: проверять текущие
переменные, не загрязняя основной код и не забывая удалить в нём
проверочные вызовы данных и функций.

## 2.2 Projects в RStudio

Проекты в RStudio обладают несколькими существенными преимуществами,
серьёзно облегчающими работу с кодом:

Индивидуальная рабочая директория. Сравнимо с тем, как если бы мы
выполнили setwd() для папки каждый раз, когда начинаем работать. Рабочие
директории проектов не пересекаются, благодаря чему можно запускать
сразу несколько проектов одновременно. Крайне не рекомендуется изменять
название директории, если вы уже создали её, иначе все пути сломаются;
Относительные пути до файлов. Каждый раз, когда мы переносим папку
проекта, пути, которые мы прописываем в коде, начинаются от папки
проекта. В результате каждый раз, когда папка проекта переносится на
новый компьютер, можно не беспокоиться, что все файлы, которые
загружаются внутри кода, внезапно перестанут читаться; Переносимость.
Результат предыдущих двух преимуществ. Когда нужно передать код, данные,
в целом наработки коллегам, можно заархивировать папку проекта и просто
переслать по почте или иному файлообменнику; Дополнительно: когда
создаётся проект, можно автоматически сделать папку проекта ещё и
репозиторием git, что упрощает работу с контролем версий. Исходя из
этого, можно предположить, что проектами стоит пользоваться всякий раз,
когда мы начинаем новый... проект анализа данных.

Например, удобно объединить в единой директории протокол, план
статистического анализа, код статистического анализа, генерируемый
статистический отчёт. В итоге всё будет находиться в одном месте и можно
будет просто открыть проект и продолжить работать с места, на котором
остановились.

писание структуры папки проекта: RProject, RHistory, RData. Пример того,
как стоит организовывать иерархию папок.

Структура папки проекта

По умолчанию папка проекта после первого сохранения содержит:

rmd-файл, в котором эффективным образом организован код. Подробнее этот
тип файла мы разберём позже; .RData --- хранилище всех переменных. Его
содержание отображается в RStudio в окне Environment, которое мы
разбирали ранее. Забавной особенностью является то, что рано или поздно
(но скорее рано) этот файл становится настолько огромным, что либо
заполняет собой всю оставшуюся память компьютера в особо неудачном
случае или, в удачном, приводит к тому, что проект загружается долгие
минуты или не может быть загружен вообще; .RHistory --- хранилище всех
изменений кода. Если вы не хотите, чтобы кто-нибудь узнал о том, как
именно вы изменяли код до тех пор, пока он не стал написан чисто и
аккуратно, этот файл тоже можно периодически очищать. Также в нём можно
найти нечаянно удалённые куски нужного кода; .RProj --- этот файл
является тем файлом, что правит всеми остальными, а ещё это точка входа
в проект. Крайне не рекомендуется изменять его название (как и название
папки проекта); Прочие папки. Остановимся на них подробнее и приведём
рекомендуемый минимальный набор. Прежде всего, для чистоты проекта лучше
создавать папку data рядом с остальными вышеперечисленными файлами. Уже
в ней можно создать следующие папки:

*originals* --- сюда просто складываем все исходные файлы, нужные для
проекта. Важной особенностью этой папки должно являться то, что файлы в
ней мы ни в коем случае не меняем. Таким образом всегда останется
резервная чистая копия, если что-то пойдёт не так в других папках. Для
работы с файлами мы просто копируем файлы из этой папки в другие;

*pics* --- сюда сохраняем картинки/графики и прочую графическую
информацию, появляющуюся в ходе анализа;

*raw* --- сырые файлы данных. Именно из этой папки мы будем читать
данные и загружать их в R для последующего анализа. В ней так же не
стоит менять файлы, чтобы гарантировать, что все изменения, проводимые в
R, проводятся на основе тех же данных, что есть у коллег;

*documents* --- здесь лежит вся документация, такая как протоколы, SAPы
(планы статистического анализа), листы регистрации и подобное. Конечно,
описанная структура папок может изменяться, но, возможно, такая
организация может облегчить анализ данных и поиск документов/данных
спустя месяцы, когда проект уже выветрился из памяти

## 2.3 RMarkdown

RMarkdown позволяет соединить текст, визуализации и код, который будет
генерировать код и даже текст в отдельных случаях.

Документы RMarkdown (Rmd) полностью воспроизводимы. Это значит, что,
когда мы закончим документ, то любой аналитик сможет позже запустить
выполнение всего файла целиком и получить на выходе потрясающе
выглядящий и полностью информативный отчёт (в случае, если мы его таким
сделали).

.Rmd файл --- это просто текстовый файл с указанным расширением. Но, в
отличие от просто .R файла он содержит в себе чанки, позволяющие
организовывать код удобным способом. Далее мы рассмотрим всё, что нужно
знать про RMarkdown-файл, подробнее.

### Заголовок, чанки, простой текст

Файл состоит из трёх основных типов содержимого:

**1) Заголовок YAML**, окружённый ---, он не обязательно должен
присутствовать, но в нём можно указывать (ниже примеры):

Пример YAML-заголовка Заголовок : title: "Example title" ---
отображается в начале документа большим шрифтом; Подзаголовок: subtitle:
"Example subtitle" --- отображается под заголовком шрифтом поменьше;
Автор: author: "User Name"; Дата: date: "`r Sys.Date()`" --- в данном
примере дата будет обновляться при каждом выводе документа в печать;
Вывод: output: word_document --- в данном примере вывод настроен на
вывод документа формата .docx.

**2. Чанки**. Вставляются с помощью Ctrl + Alt + I или просто с помощью
написания `{r} в начале чанка и закрывающих` в конце чанка. Внутри мы
пишем код, вывод которого печатается после чанка. Этот же вывод появится
в итоговом документе:

Типичный чанк В фигурных скобках после указания r как используемого в
чанке языка можно через пробел указать название чанка, чтобы позже было
проще ориентироваться; Шестерёнка в правом верхнем углу позволяет
настраивать в графическом режиме параметры чанков, которые мы изучим в
следующих уроках; Кнопка в виде белого треугольника с зелёной полоской
выполнит все фрагменты кода выше данного текущего чанка. Также можно
сделать с помощью постановки курсора в чанк и горячих клавишей Ctrl +
Alt + P; Крайний правый зелёный треугольник просто выполнит весь код в
чанке.

**3. Простой текст.**

```         
*выделение* (например, курсив)
**сильное выделение** (например, полужирное начертание)
```

### **Программный код**

Элементы кода могут быть внутри строки (inline) либо многострочными
блоками.

Внутри строки код выделяется символом «\`» ([обратный
апостроф](https://ru.wikipedia.org/wiki/%D0%9C%D0%B0%D1%88%D0%B8%D0%BD%D0%BE%D0%BF%D0%B8%D1%81%D0%BD%D1%8B%D0%B9_%D0%BE%D0%B1%D1%80%D0%B0%D1%82%D0%BD%D1%8B%D0%B9_%D0%B0%D0%BF%D0%BE%D1%81%D1%82%D1%80%D0%BE%D1%84 "Машинописный обратный апостроф")).

```         
Пример кода внутри строки (inline) `Hello world!`
```

Многострочный блок кода обозначается отступом из 4 пробелов или одного
[Tab](https://ru.wikipedia.org/wiki/%D0%A2%D0%B0%D0%B1%D1%83%D0%BB%D1%8F%D1%86%D0%B8%D1%8F "Табуляция").

```         
Ниже начинается многострочный блок кода

    <!doctype html>
    <html>
        <head>
            <!-- Заголовок документа -->
        </head>
        <body>
            <!-- Тело документа -->
        </body>
    </html>

Блок кода завершился
```

### **Зачёркнутый текст**

```         
необходимо сделать ~~одну~~ другую вещь
```

### **Списки**

```         
* элемент маркированного списка
- ещё один элемент ненумерованного списка
+ буллеты элементов могут быть разными

1. Элемент нумерованного списка
2. Элемент №2 того же списка
9. Элемент №3 списка — элементы нумеруются по порядку, цифра в начале строки не имеет значения
```

### **Заголовки**

Создание заголовков производится путём помещения [знака
решетки](https://ru.wikipedia.org/wiki/%D0%9E%D0%BA%D1%82%D0%BE%D1%82%D0%BE%D1%80%D0%BF "Октоторп")
перед текстом заголовка. Количество знаков «#» соответствует уровню
заголовка. HTML предоставляет 6 уровней заголовков.

```         
# Заголовок первого уровня
...
### Заголовок третьего уровня
...
###### Заголовок шестого уровня
```

Первые два уровня заголовка также имеют альтернативный синтаксис:

```         
Заголовок первого уровня
========================

Заголовок второго уровня
------------------------
```

### **Цитаты (тег blockquote)**

```         
> Данный текст будет заключен в HTML-теги <blockquote></blockquote>
```

### **Ссылки**

```         
[Текст ссылки](http://example.com/ "Необязательный заголовок ссылки")
```

Альтернативный способ задавать ссылки, если есть повторения:

```         
Где-то среди текста встречается [текст ссылки][example].

Также ссылка повторяется [пример адреса][example].

Ссылка на [второй][foo] также [Bar][] ресурсы.

[example]: http://example.com/ "Необязательный заголовок ссылки"
[foo]: http://example.net/ 'Необязательный заголовок ссылки'
[bar]: http://example.edu/ (Необязательный заголовок ссылки)
```

### **Изображения**

```         
![Alt-текст](http://example.com/ "Заголовок изображения")
```

## **Первый чанк**

![](https://ucarecdn.com/5efee9b9-c998-40b3-a7a7-fb1f9b9e19e4/){alt=""}

В каждом rmd-файле есть первый чанк, что правит всеми остальными.

В нём находится `knitr::opts_chunck$set()`, в котором устанавливаются
общие параметры вывода чанков.

В нём же следует писать и код подключения пакетов, чтобы они
автоматически подключались, а также чтобы каждый новый человек, который
будет работать с кодом, мог сразу понять, какие пакеты будут
использоваться в анализе.

Сюда же можно рекомендовать класть и собственноручно написанные функции
с тем, чтобы они автоматически подгружались при запуске и чтобы не
случилось внезапно так, что функция используется раньше, чем будет
объявлена.

### **Настройки Rmd-файла**

Многие функции помимо выполнения основной цели добавляют в вывод
различные сообщения, а ещё могут выдавать предупреждения и даже ошибки.

Таже чаще всего тем, кто будет смотреть статистический отчёт, не нужен
код, который создаёт таблицы. Им нужны сами таблицы, а код можно
посмотреть в пересланном проекте. 

Именно для таких случаев, а также нескольких дополнительных нужны
настройки чанков. Обычно самые критичные стоит устанавливать в первом
чанке, а именно в функции, которая по умолчанию появляется в нём, когда
создаётся rmd-файл:

![](https://ucarecdn.com/07c78438-08d5-484b-bba0-5714bed82bf3/){alt=""}

Изучим список основных функций. Значения по умолчанию сразу будут
приведены вместе с названием:

1.   `echo = TRUE` --- показывать ли код при печати документа. Обычно
    это не нужно, поэтому есть смысл установить `FALSE`;

2.  `error = FALSE` --- показывать ли при печати ошибки;

3.  `eval = TRUE` --- выполнять ли код в чанке. Обычно мы действительно
    хотим, чтобы код в чанке выполнялся, однако иногда есть смысл
    временно или навсегда выключить один или несколько чанков из кода. В
    таком случае этот чанк на всякий случай останется, но выполняться не
    будет:![](https://ucarecdn.com/30dbc5de-730f-4cf6-9469-d316dcb09b1b/){alt=""}

4.  `message = TRUE` --- выводить ли в печать сообщения от функций.
    Обычно это тоже не нужно;

5.  `warning = TRUE` --- большинство предупреждений выводятся только
    один раз, но не стоит включать их в статистический отчёт;

6.  `fig.width  = 7` и `fig.height = 7` --- размеры изображений в
    дюймах. Если не указано иное, стоит устанавливать нужные значения в
    каждом отдельном чанке после того, как эти значения будут подобраны
    опытным путём (они могут быть и дробными):

    ![](https://ucarecdn.com/28a5bad3-3fe9-4044-88f6-48ced54ed522/){alt=""}

## **Оглавление документа**

![](https://ucarecdn.com/55f6007e-c69d-49b4-9119-6c8723401179/){alt=""}

Если аккуратно расставлять заголовки (напомним, они делаются с помощью
знаков `#`), то открывается возможность сделать автоматическое
оглавление, которое будет собираться на основе этих заголовков разных
уровней.

Для этого используется параметр `toc: yes`. 

Дополнительно можно ограничить количество возможных уровней списков в
оглавлении с помощью соответствующего параметра. В примере количество
уровней ограничено тремя: `toc_depth: 3`.

Наконец, по умолчанию заголовок оглавления будет "Table of Contents", но
зачастую мы хотим изменить его. Для этого используется параметр
`toc-title: "Оглавление"` как в примере. Обратите внимание, что, в
отличие от остальных параметров, связанных с автоматическим оглавлением,
этот параметр пишется без отступов.

## **Печать файла в Word, html, pdf**

Нужно выбрать, в какие форматы печатается RMarkdown.

![](https://ucarecdn.com/b81000dd-7cb0-404e-b0d6-0d9c41b82b93/){alt=""}

Напечатать документ очень легко. Для этого надо на верхней панели нажать
на треугольник рядом
с ![](https://ucarecdn.com/df65c967-8498-404f-8043-76db55b43920/){alt=""},
после чего выбрать нужный формат из выпавшего списка. Для иных форматов
нужно вручную прописать формат вывода в заголовке файла.

Ниже выберите правильные варианты того, какие форматы доступны для
печати из RMarkdown. При необходимости попробуйте найти ответ с помощью
поиска в Интернете:

### **Референсный документ**

![](https://ucarecdn.com/eca2b0b9-5e94-4f19-9f14-f68eba3a1523/){alt=""}

Забавной особенностью печати в формат .docx является то, что для неё
доступен параметр референсного документа.

Этот документ --- просто документ .docx, но с установленными шрифтами
для текста, заголовков, таблиц, ориентации страниц, количества колонок
на каждой странице, одним словом, всего, что вообще возможно
отформатировать в Word. 

Если иметь такой файл (можно назвать его так, как на картинке выше и
переносить из проекта в проект), то достаточно положить его в ту же
папку, где находится и файл .Rproj. Остальное сделает сам генератор
документов: форматирование будет таким, какое мы ожидаем. 

Особенно удобно это, когда в нашем распоряжении находится образец
статистического отчёта, и нам нужно сделать такой же по формату, но
другой по наполнению.

# 3. Пакеты R

## 3.1 Работа с пакетами

**Что такое пакет?**

**Пакет R** --- это строгим образом организованный код, предоставляющий
дополнительные функции для выполнения самых разнообразных действий: от
статистических расчётов и печати отчётов до создания игр и простых
сайтов.

Например, в этом курсе мы в основном изучаем пакеты, представленные на
картинке ниже:

![[tidyverse.org](https://www.tidyverse.org/)](https://ucarecdn.com/5a20c7be-717f-446d-a992-db83331e7cf3/){alt=""}

Базовый список пакетов, которые по умолчанию загружаются вместе с R при
первой установке (всего 30): *base, compiler, datasets, grDevices,
graphics, grid, methods, parallel, splines, stats, stats4, tcltk, tools,
translations, utils, KernSmooth, MASS, Matrix, boot, class, cluster,
codetools, foreign, lattice, mgcv, nlme, nnet, rpart, spatial, and
survival*.

При должном старании и наличии времени с помощью только лишь этих
пакетов возможно осуществить большую часть видов статистического анализа
данных и даже создать отчёт, но с помощью *tidyverse* и *knitr* делать
это приятнее и удобнее.

Описание каждого пакета можно посмотреть в разделе DESCRIPTION.
Например, вот начало этого раздела (под названием) для пакета ggplot2:

![](https://ucarecdn.com/623f101c-d2e6-4462-a385-fdb7ea7008a3/){alt=""}

Также справку о пакете можно получить командой
`help(package = "package_name")`. Например, попробуем получить справку
по пакету ggplot2: 

![](https://ucarecdn.com/4e17f593-0b8b-42a5-bdac-523ebcc81fa7/){alt=""}

Если нужно вставить цитирование пакета, можно выполнить функцию
`citation("package_name")`. Процитируем для примера вновь тот же пакет
ggplot2:

![](https://ucarecdn.com/e81f0ffd-4681-4e22-a4ff-475124d3c945/){alt=""}

**Что такое репозиторий? Три основных репозитория для R**

Репозиторий --- это место хранения пакетов программ, дополнительно
оснащённый информацией, позволяющей понять, зачем нужен каждый данный
пакет. Дополнительно присутствует функционал установки и обновления
пакетов и часто даже гарантии того, что в пакете нет вирусов, а
работоспособность кода в пакетах проверена на различных системах и
машинах.

[**CRAN**](https://stepik.org/lesson/1403995/step/cran.r-project.org)
**(Comprehensive R Archive Network)**

Основной и центральный репозиторий, поддерживаемый R Foundation и
расположенный в Венском университете экономики и бизнеса и зеркалах по
всему миру. На данный момент он содержит более 17000 пакетов, каждый из
которых проверен вручную командой CRAN. 

[**Bioconductor**](https://stepik.org/lesson/1403995/step/www.bioconductor.org)

Специализированный для анализа геномных и прочих биологических данных
репозиторий.

[**github** ](https://stepik.org/lesson/1403995/step/github.com)**и
прочие**

На самом деле это веб-сервис для совместной разработки программного
обеспечения, но именно поэтому на нём и выкладываются многие очень
полезные пакеты.

**Разница между пакетом и библиотекой**

Важно отличать эти понятия: в то время, когда пакет --- это особым
образом организованный код, библиотекой принято называть ту или те
директории, в которые эти пакеты "складируются" на компьютере для
последующего использования.

Библиотеки чаще всего создаются автоматически. Например, если на
компьютере установлено несколько разных версий R, скорее всего будет и
несколько библиотек.

Важно, чтобы у пользователя был доступ к изменению и чтению папки, иначе
пакеты не смогут быть установлены.

Посмотреть пути к библиотекам очень просто. Нужно выполнить функцию
`.libPaths()`:

![](https://ucarecdn.com/9582953f-9594-4608-87b3-808df1aa43ed/){alt=""}

В примере видно, что на компьютере есть только одна библиотека, путь к
которой и указан в выводе функции.

Разумеется, можно посмотреть и список пакетов, установленных в
библиотеке. Достаточно вызвать функцию `library()` без аргументов.
Проверим:

![](https://ucarecdn.com/137c2999-170f-466a-8f8e-ee8291727e39/){alt=""}

**Манипуляции с пакетами с CRAN**

[Устанавливать пакеты]{.underline} просто: 

1.  Если мы хотим установить один пакет, достаточно написать
    так: `install.packages("package_name")`;

2.  Но легко установить и сразу несколько пакетов, для чего нужно
    использовать синтаксис
    вектора: `install.packages(c("package_name", "package_name_2", "package_name_3"))`.

Проверка того, [какие пакеты установлены]{.underline}, проводится через
функцию `installed.packages()`, которая возвращает: имя пакета; путь к
библиотеке, где лежит пакет; версию пакета и зависимости:

![](https://ucarecdn.com/caa8d2ac-587a-4059-97a0-916e9d9350f3/){alt=""}

Иногда необходимо [удалить пакет]{.underline}, что можно сделать
функцией: `remove.packages("package_name")`. Часто это может
пригодиться, если внезапно пакет выдаёт ошибку после неудачного
обновления и нужно поставить его с нуля.

Вывод [списка устаревших пакетов]{.underline} производится
функцией `old.packages()`, которая выводит текущую версию пакета и самую
новую, которая содержится в подключённом репозитории, а также даёт
ссылку на этот репозиторий:

![](https://ucarecdn.com/983665fa-a129-4054-af9e-beecc756eea5/){alt=""}

После того, как мы узнали, какие пакеты устарели, может возникнуть
необходимость или желание обновить пакеты, что делается
функцией `update.packages("package_name")`.

 

**Манипуляции с пакетами через Bioconductor**

Прежде, чем устанавливать пакеты с Bioconductor, необходимо установить
функцию для установки: `source("https://bioconductor.org/biocLite.R")`.

```{r}
source("https://bioconductor.org/biocLite.R")
```

После этого всё происходит аналогично стандартной функции. Например:
`biocLite("package_name")`.

**Манипуляции с пакетами через devtools**

Почти всегда установка пакетов с github нужно, чтобы предварительно были
установлены **RTools**, что мы сделали в самых первых шагах.

Основная функция установки пакетов с github:
`devtools::install_github("hadley/dplyr")`. В этом примере из
репозитория *hadley* (основной разработчик tidyverse) устанавливается
пакет *dplyr*.

Для расширения представления упомянем также функции: install_bioc(),
install_bitbucket(), install_cran(), install_git(), install_local(),
install_url(), install_version().
